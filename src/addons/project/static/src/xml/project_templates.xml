<?xml version="1.0" encoding="utf-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="dayOfWeekWidget">
        <table class="o-dow-widget">
            <thead>
                <tr>
                    <th t-foreach="widget.labels" t-as="label">
                        <t t-esc="label"/>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr class="o-dow-days" />
            </tbody>
        </table>
    </t>

    <span t-name="project.statusWithColor" t-att-class="'o-status-bubble mr-2 o-color-bubble-' + color"></span>

    <div t-name="project.ControlPanel" t-inherit="web.Legacy.ControlPanel" t-inherit-mode="extension" owl="1">
        <xpath expr="//ol[contains(@class, 'breadcrumb')]" position="inside">
            <t t-call="project.ProjectControlPanelContent">
                <t t-set="showProjectUpdate" t-value="showProjectUpdate"/>
                <t t-set="isProjectUser" t-value="isProjectUser"/>
            </t>
        </xpath>
    </div>

    <t t-name="project.ProjectRightPanel" owl="1">
        <div t-if="projectId" class="o-rightpanel">
            <t t-call="project.StatButtonsSection"/>
            <t t-call="project.MilestoneSection"/>
        </div>
        <!-- If this is called from notif, multiples updates but no specific project -->
        <div t-else=""/>
    </t>

    <t t-name="project.StatButtonsSection" owl="1">
        <div class="o-rightpanel-section">
            <div class="o-form-view">
                <div class="oe-button-box o-full">
                    <t t-foreach="state.data.buttons" t-as="button" t-key="button.order">
                        <button class="btn oe-stat-button" t-if="button.show"
                            t-on-click="onProjectActionClick" 
                            t-att-data-action="button.action"
                            t-att-data-additionalContext="button.additionalContext"
                            t-att-data-type="button.actionType">
                            <i t-att-class="'fa fa-fw o-button-icon fa-' + button.icon"/>
                            <div class="o-field-widget o-stat-info">
                                <span class="o-stat-value">
                                    <t t-esc="button.number"/>
                                </span>
                                <span class="o-stat-text">
                                    <t t-esc="button.text"/>
                                </span>
                            </div>
                        </button>
                    </t>
                </div>
            </div>
        </div>
    </t>

    <t t-name="project.MilestoneSection" owl="1">
        <t t-set="milestones" t-value="state.data.milestones"/>
        <div class="o-rightpanel-section" name="milestone">
            <div class="o-rightpanel-header">
                <div class="o-rightpanel-title">
                    Milestones
                </div>
                <span class="o-rightpanel-button">
                    <AddMilestone context="context"/>
                </span>
            </div>
            <div class="o-rightpanel-data">
                <div t-foreach="milestones.data" t-as="milestone" t-key="milestone.id" class="o-rightpanel-data-row">
                    <OpenMilestone context="context" milestone="milestone" t-key="milestone.id"/>
                </div>
                <span t-if="milestones.data.length === 0" class="text-muted font-italic">
                    Track major progress points that must be reached to achieve success.
                </span>
            </div>
        </div>
    </t>

    <t t-name="project.AddMilestone" owl="1">
        <div class="o-add-milestone">
            <a t-on-click="onAddMilestoneClick">Add Milestone</a>
            <span t-if="state.openDialog" class="o-rightpanel-hidden">
                <ComponentAdapter
                    Component="FormViewDialog"
                    params="{
                        context: context,
                        _createContext: _createContext,
                        onSaved: _onDialogSaved,
                        resId: false,
                        resModel: 'project.milestone',
                        title: NEW_PROJECT_MILESTONE,
                        multiSelect: true,
                    }"
                    t-ref="dialog"
                />
            </span>
        </div>
    </t>

    <t t-name="project.OpenMilestone" owl="1">
        <div class="o-open-milestone row" t-att-class="state.colorClass">
            <span class="o-milestone-checkbox col-1" t-on-click="onMilestoneClick">
                <i class="fa" t-att-class="state.checkboxIcon"></i>
            </span>
            <div class="o-milestone-detail col-10 p-0" t-on-click="onOpenMilestone">
                <span class="text-truncate col-8 px-0" t-att-title="milestone.label" style="flex: 10%">
                    <t t-esc="milestone.label"/>
                </span>
                <span class="o-rightpanel-center-col col-4">
                    <t t-esc="deadline"/>
                </span>
            </div>
            <span class="o-rightpanel-right-col col-1 px-0">
                <a class="o-delete-icon" t-on-click="onDeleteMilestone" title="Delete Milestone"><i class="fa fa-trash"></i></a>
            </span>
            <span t-if="state.openDialog" class="o-rightpanel-hidden">
                <ComponentAdapter
                    Component="FormViewDialog"
                    params="{
                        context: context,
                        onSaved: _onDialogSaved,
                        resId: milestone.id,
                        resModel: 'project.milestone',
                        title: OPEN_PROJECT_MILESTONE,
                        disableMultipleSelection: true,
                        deletable: true
                    }"
                    t-ref="dialog"
                />
            </span>
        </div>
    </t>

</templates>
