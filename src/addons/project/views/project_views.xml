<?xml version="1.0" encoding="utf-8"?>
<verp>

        <!-- Top menu item -->
        <menuitem name="Project"
            id="menuMainPm"
            groups="groupProjectManager,groupProjectUser"
            webIcon="project,static/description/icon.png"
            sequence="70"/>

        <menuitem id="menuProjectConfig" name="Configuration" parent="menuMainPm"
            sequence="100" groups="project.groupProjectManager"/>

        <record id="viewTaskSearchForm" model="ir.ui.view">
            <field name="label">project.task.search.form</field>
            <field name="model">project.task</field>
            <field name="arch" type="xml">
               <search string="Tasks">
                    <field name="label" string="Task"/>
                    <field name="tagIds"/>
                    <field name="userIds" filterDomain="[['userIds.label', 'ilike', self], ['userIds.active', 'in', [true, false]]]"/>
                    <field string="Project" name="displayProjectId"/>
                    <field name="stageId"/>
                    <field name="partnerId" operator="childOf"/>
                    <field name="parentId"/>
                    <filter string="My Tasks" name="myTasks" domain="[['userIds', 'in', uid]]"/>
                    <filter string="Unassigned" name="unassigned" domain="[['userIds', '=', false]]"/>
                    <separator/>
                    <filter string="Starred" name="starred" domain="[['priority', 'in', [0, 1]]]"/>
                    <separator/>
                    <filter string="Late Tasks" name="late" domain="[['dateDeadline', '&lt;', contextToday().toFormat('yyyy-MM-dd')], ['isClosed', '=', false]]"/>
                    <separator/>
                    <filter string="Rated Tasks" name="ratingTask" domain="[['ratingLastValue', '!=', 0.0]]" groups="project.groupProjectRating"/>
                    <separator/>
                    <filter string="Unread Messages" name="messageNeedaction" domain="[['messageNeedaction', '=', true]]"/>
                    <separator/>
                    <filter string="Archived" name="inactive" domain="[['active', '=', false]]"/>
                    <separator/>
                    <filter invisible="1" string="Late Activities" name="activitiesOverdue"
                        domain="[['myActivityDateDeadline', '&lt;', contextToday().toFormat('yyyy-MM-dd')]]"
                        help="Show all records which has next action date is before today"/>
                    <filter invisible="1" string="Today Activities" name="activitiesToday"
                        domain="[['myActivityDateDeadline', '=', contextToday().toFormat('yyyy-MM-dd')]]"/>
                    <filter invisible="1" string="Future Activities" name="activitiesUpcomingAll"
                        domain="[['myActivityDateDeadline', '&gt;', contextToday().toFormat('yyyy-MM-dd')]]"/>
                    <group expand="0" string="Group By">
                        <filter string="Stage" name="stage" context="{'groupby': 'stageId'}"/>
                        <filter string="Personal Stage" name="personalStage" context="{'groupby': 'personalStageTypeIds'}"/>
                        <filter string="Assignees" name="user" context="{'groupby': 'userIds'}"/>
                        <filter string="Project" name="project" context="{'groupby': 'projectId'}"/>
                        <filter string="Customer" name="customer" context="{'groupby': 'partnerId'}"/>
                        <filter string="Kanban State" name="kanbanState" context="{'groupby': 'kanbanState'}"/>
                        <filter string="Deadline" name="dateDeadline" context="{'groupby': 'dateDeadline'}"/>
                        <filter string="Creation Date" name="groupCreatedAt" context="{'groupby': 'createdAt'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="viewTaskSearchFormExtended" model="ir.ui.view">
            <field name="label">project.task.search.form.extended</field>
            <field name="model">project.task</field>
            <field name="inheritId" ref="viewTaskSearchForm"></field>
            <field name="mode">primary</field>
            <field name="arch" type="xml">
               <xpath expr="//filter[@name='unassigned']" position="after">
                    <separator/>
                    <filter string="My Projects" name="myProjects" domain="[['projectId.userId', '=', uid]]"/>
                    <filter string="My Favorite Projects" name="myFavoriteProjects" domain="[['projectId.favoriteUserIds', 'in', [uid]]]"/>
                    <filter string="Followed Projects" name="myFollowedProjects" domain="[['projectId.messageIsFollower', '=', true]]"/>
                </xpath>
            </field>
        </record>

        <record id="actProjectProject2ProjectTaskAll" model="ir.actions.actwindow">
            <field name="label">Tasks</field>
            <field name="resModel">project.task</field>
            <field name="viewMode">kanban,tree,form,calendar,pivot,graph,activity</field>
            <field name="domain">[['displayProjectId', '=', activeId]]</field>
            <field name="context">{
                'pivotRowGroupby': ['userIds'],
                'default_projectId': activeId,
                'showProjectUpdate': true,
            }</field>
            <field name="searchViewId" ref="viewTaskSearchForm"/>
            <field name="help" type="html">
                <p class="o-view-nocontent-smiling-face">
                    No tasks found. Let's create one!
                </p><p>
                    To get things done, use activities and status on tasks.<br/>
                    Chat in real-time or by email to collaborate efficiently.
                </p>
            </field>
        </record>

        <!-- Task types -->
        <record id="taskTypeSearch" model="ir.ui.view">
            <field name="label">project.task.type.search</field>
            <field name="model">project.task.type</field>
            <field name="arch" type="xml">
                <search string="Tasks Stages">
                   <field name="label" string="Name"/>
                    <filter string="Archived" name="inactive" domain="[['active', '=', false]]"/>
                </search>
            </field>
        </record>

        <record id="taskTypeEdit" model="ir.ui.view">
            <field name="label">project.task.type.form</field>
            <field name="model">project.task.type</field>
            <field name="arch" type="xml">
                <form string="Task Stage" delete="0">
                    <field name="active" invisible="1" />
                    <sheet>
                        <widget name="webRibbon" title="Archived" bgcolor="bg-danger" attrs="{'invisible': [['active', '=', true]]}" />
                        <group>
                            <group>
                                <field name="label"/>
                                <field name="mailTemplateId" context="{'default_model': 'project.task'}"/>
                                <field name="ratingTemplateId" groups="project.groupProjectRating" context="{'default_model': 'project.task'}"/>
                                <field name="sequence" groups="base.groupNoOne"/>
                                <div class="alert alert-warning" role="alert" colspan='2' attrs="{'invisible': ['|', ['ratingTemplateId','=', false], ['disabledRatingWarning', '=', false]]}">
                                    <i class="fa fa-warning" title="Customer disabled on projects"/><b> Customer Ratings</b> are disabled on the following project(s) : <br/>
                                    <field name="disabledRatingWarning" class="mb-0" />
                                </div>
                                <field name="autoValidationKanbanState" attrs="{'invisible': [['ratingTemplateId','=', false]]}" groups="project.groupProjectRating"/>
                            </group>
                            <group>
                                <field name="fold"/>
                                <field name="isClosed" groups="base.groupNoOne"/>
                                <field name="projectIds" widget="many2manyTags" options="{'colorField': 'color'}" required="1"/>
                            </group>
                        </group>
                        <group string="Stage Description and Tooltips">
                            <group>
                                <p class="text-muted" colspan="2">
                                    At each stage, employees can block tasks or mark them as ready for the next step.
                                    You can customize here the labels for each state.
                                </p>
                                <div class="row ml-1" colspan="2">
                                    <label for="legendNormal" string=" " class="o-status mt4"
                                        title="Task in progress. Click to block or set as done."
                                        aria-label="Task in progress. Click to block or set as done." role="img"/>
                                    <div class="col-11 pl-0">
                                        <field name="legendNormal"/>
                                    </div>
                                </div>
                                <div class="row ml-1" colspan="2">
                                    <label for="legendBlocked" string=" " class="o-status o-status-red mt4"
                                        title="Task is blocked. Click to unblock or set as done."
                                        aria-label="Task is blocked. Click to unblock or set as done." role="img"/>
                                    <div class="col-11 pl-0">
                                        <field name="legendBlocked"/>
                                    </div>
                                </div>
                                <div class="row ml-1" colspan="2">
                                    <label for="legendDone" string=" " class="o-status o-status-green mt4"
                                        title="This step is done. Click to block or set in progress."
                                        aria-label="This step is done. Click to block or set in progress." role="img"/>
                                    <div class="col-11 pl-0">
                                        <field name="legendDone"/>
                                    </div>
                                </div>

                                <p class="text-muted mt-2" colspan="2">
                                    You can also add a description to help your coworkers understand the meaning and purpose of the stage.
                                </p>
                                <field name="description" placeholder="Add a description..." nolabel="1" colspan="2"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="personalTaskTypeEdit" model="ir.ui.view">
            <field name="label">project.task.type.form</field>
            <field name="model">project.task.type</field>
            <field name="arch" type="xml">
                <form string="Task Stage" delete="0">
                    <field name="active" invisible="1" />
                    <sheet>
                        <widget name="webRibbon" title="Archived" bgcolor="bg-danger" attrs="{'invisible': [['active', '=', true]]}" />
                        <group>
                            <group>
                                <field name="label"/>
                                <field name="sequence" groups="base.groupNoOne"/>
                            </group>
                            <group>
                                <field name="fold"/>
                            </group>
                        </group>
                        <group>
                            <group>
                                <field name="description" placeholder="Add a description..." nolabel="1" colspan="2"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="taskTypeTree" model="ir.ui.view">
            <field name="label">project.task.type.tree</field>
            <field name="model">project.task.type</field>
            <field name="arch" type="xml">
                <tree string="Task Stage" delete="0" sample="1" multiEdit="1">
                    <field name="sequence" widget="handle" optional="show"/>
                    <field name="label"/>
                    <field name="mailTemplateId" optional="hide"/>
                    <field name="ratingTemplateId" optional="hide" groups="project.groupProjectRating"/>
                    <field name="projectIds" optional="show" widget="many2manyTags" options="{'colorField': 'color'}" />
                    <field name="fold" optional="show"/>
                    <field name="userId" optional="show"/>
                </tree>
            </field>
        </record>

        <record id="viewProjectTaskTypeKanban" model="ir.ui.view">
            <field name="label">project.task.type.kanban</field>
            <field name="model">project.task.type</field>
            <field name="arch" type="xml">
                <kanban class="o-kanban-mobile" sample="1">
                    <field name="label"/>
                    <field name="fold"/>
                    <field name="description"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe-kanban-global-click">
                                <div class="row">
                                    <div class="col-12">
                                        <strong><t t-esc="record.label.value"/></strong>
                                    </div>
                                </div>
                                <field name="projectIds" widget="many2manyTags" options="{'colorField': 'color'}"/>
                                <t t-if="record.description.value">
                                    <hr class="mt8 mb8"/>
                                    <t t-esc="record.description.value"/>
                                </t>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="openTaskTypeForm" model="ir.actions.actwindow">
            <field name="label">Task Stages</field>
            <field name="resModel">project.task.type</field>
            <field name="viewMode">tree,kanban,form</field>
            <field name="viewId" ref="taskTypeTree"/>
            <field name="domain">[['userId', '=', false]]</field>
            <field name="help" type="html">
              <p class="o-view-nocontent-smiling-face">
                No stages found. Let's create one!
              </p><p>
                Track the progress of your tasks from their creation to their closing.
              </p>
            </field>
        </record>

        <record id="openTaskTypeFormDomain" model="ir.actions.actwindow">
            <field name="label">Task Stages</field>
            <field name="resModel">project.task.type</field>
            <field name="viewMode">tree,kanban,form</field>
            <field name="domain">[['projectIds','=', projectId]]</field>
            <field name="viewId" ref="taskTypeTree"/>
            <field name="help" type="html">
                <p class="o-view-nocontent-smiling-face">
                Create a new stage in the task pipeline
                </p><p>
                Define the steps that will be used in the project from the
                creation of the task, up to the closing of the task or issue.
                You will use these stages in order to track the progress in
                solving a task or an issue.
                </p>
            </field>
        </record>

        <record id="unlinkTaskTypeAction" model="ir.actions.server">
            <field name="label">Delete</field>
            <field name="modelId" ref="project.model_projectTaskType"/>
            <field name="bindingModelId" ref="project.model_projectTaskType"/>
            <field name="bindingViewTypes">form,list</field>
            <field name="state">code</field>
            <field name="code">records.unlinkWizard(true)</field>
        </record>

        <!-- Project -->
        <record id="editProject" model="ir.ui.view">
            <field name="label">project.project.form</field>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <form string="Project" class="o-form-project-project" delete="0">
                    <header>
                        <button name="%(project.projectShareWizardAction)d" string="Share Readonly" type="action" class="oe-highlight" groups="project.groupProjectManager"
                        attrs="{'invisible': [['privacyVisibility', '!=', 'portal']]}" context="{'default_accessMode': 'read'}"/>
                        <button name="%(project.projectShareWizardAction)d" string="Share Editable" type="action" class="oe-highlight" groups="project.groupProjectManager"
                        attrs="{'invisible': [['privacyVisibility', '!=', 'portal']]}" context="{'default_accessMode': 'edit'}"/>
                        <field name="stageId" widget="statusbar" options="{'clickable': '1', 'foldField': 'fold'}" groups="project.groupProjectStages"/>
                    </header>
                <sheet string="Project">
                    <div class="oe-button-box" name="buttonBox" groups="base.groupUser">
                        <field name="currencyId" invisible="1"/>
                        <button class="oe-stat-button" type="action"
                            name="%(actProjectProject2ProjectTaskAll)d" icon="fa-tasks">
                            <field string="Tasks In Progress" name="taskCount" widget="statinfo" options="{'labelField': 'labelTasks'}"/>
                        </button>
                        <button class="oe-stat-button" name="%(project.projectMilestoneAll)d" type="action" icon="fa-check-square-o">
                            <div class="o-field-widget o-stat-info">
                                <span class="o-stat-value">
                                    <field name="milestoneCount" nolabel="1"/>
                                </span>
                                <span class="o-stat-text">
                                    Milestones
                                </span>
                            </div>
                        </button>
                        <button name="actionViewAllRating" type="object" attrs="{'invisible': ['|', ['ratingActive', '=', false], ['ratingPercentageSatisfaction', '=', -1]]}" class="oe-stat-button oe-read-only" icon="fa-smile-o" groups="project.groupProjectRating">
                            <div class="o-field-widget o-stat-info">
                                <span class="o-stat-value">
                                    <field name="ratingPercentageSatisfaction" nolabel="1"/>
                                    %
                                </span>
                                <span class="o-stat-text">
                                    Customer Satisfaction
                                </span>
                            </div>
                        </button>
                        <button name="%(actionProjectTaskBurndownChartReport)d" type="action" class="oe-stat-button" icon="fa-area-chart" groups="project.groupProjectManager">
                            <span class="o-stat-text">
                                Burndown Chart
                            </span>
                        </button>
                        <button class="oe-stat-button" type="object" name="actionViewAnalyticAccountEntries" icon="fa-usd" attrs="{'invisible': [['analyticAccountId', '=', false]]}" groups="analytic.groupAnalyticAccounting">
                            <div class="o-form-field o-stat-info">
                                <span class="o-stat-value">
                                    <field name="analyticAccountBalance"/>
                                </span>
                                <span class="o-stat-text">Gross Margin</span>
                            </div>
                        </button>
                        <button class="oe-stat-button" name="%(project.projectCollaboratorAction)d" type="action" icon="fa-users" groups="project.groupProjectManager">
                            <div class="o-field-widget o-stat-info">
                                <span class="o-stat-value">
                                    <field name="collaboratorCount" nolabel="1"/>
                                </span>
                                <span class="o-stat-text">
                                    Collaborators
                                </span>
                            </div>
                        </button>
                        <button class="oe-stat-button" name="%(project.projectUpdateAllAction)d" type="action" groups="project.groupProjectManager">
                            <div class="pl-4">
                                <field name="lastUpdateColor" invisible="1"/>
                                <field name="lastUpdateStatus" widget="statusWithColor" options="{'colorField': 'lastUpdateColor'}"/>
                            </div>
                        </button>
                        <button class="oe-stat-button o-project-not-clickable" disabled="disabled" groups="!project.groupProjectManager">
                            <div class="pl-4">
                                <field name="lastUpdateColor" invisible="1"/>
                                <field name="lastUpdateStatus" widget="statusWithColor" options="{'colorField': 'lastUpdateColor', 'noQuickEdit': 1}"/>
                            </div>
                        </button>
                    </div>
                    <widget name="webRibbon" title="Archived" bgcolor="bg-danger" attrs="{'invisible': [['active', '=', true]]}"/>
                    <div class="oe-title">
                        <h1>
                            <field name="label" class="text-break" placeholder="Project Name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="labelTasks" string="Name of the tasks"/>
                            <field name="partnerId" widget="resPartnerMany2one"/>
                            <field name="tagIds" widget="many2manyTags" options="{'colorField': 'color'}"/>
                        </group>
                        <group>
                            <field name="active" invisible="1"/>
                            <field name="userId" string="Project Manager" widget="many2oneAvatarUser" attrs="{'readonly':[['active','=',false]]}" domain="[['share', '=', false]]"/>
                            <label for="dateStart" string="Dates"/>
                            <div name="dates" class="o-row">
                                <field name="dateStart" widget="daterange" options='{"relatedEndDate": "date"}'/>
                                <i class="fa fa-long-arrow-right mx-2 oe-edit-only" aria-label="Arrow icon" title="Arrow"/>
                                <i class="fa fa-long-arrow-right mx-2 oe-read-only" aria-label="Arrow icon" title="Arrow" attrs="{'invisible': [['dateStart', '=', false], ['date', '=', false]]}"/>
                                <field name="date" widget="daterange" options='{"relatedStartDate": "dateStart"}'/>
                            </div>
                            <field name="companyId" groups="base.groupMultiCompany"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="description" string="Description">
                            <field name="description"/>
                        </page>
                        <page name="settings" string="Settings">
                            <group>
                                <group>
                                    <field name="analyticAccountId" domain="['|', ['companyId', '=', companyId], ['companyId', '=', false]]" context="{'default_partnerId': partnerId}" groups="analytic.groupAnalyticAccounting"/>
                                    <field name="privacyVisibility" widget="radio"/>
                                </group>
                                <group>
                                    <div name="aliasDef" colspan="2" class="pb-2" attrs="{'invisible': [['aliasDomain', '=', false]]}">
                                        <!-- Always display the whole alias in edit mode. It depends in read only -->
                                        <field name="aliasEnabled" invisible="1"/>
                                        <span class="font-weight-bold oe-read-only" attrs="{'invisible': [['aliasName', '!=', false]]}" style="opacity: 0.7;">Create tasks by sending an email to </span>
                                        <span class="font-weight-bold oe-read-only text-dark" attrs="{'invisible': [['aliasName', '=', false]]}">Create tasks by sending an email to </span>
                                        <span class="font-weight-bold oe-edit-only text-dark">Create tasks by sending an email to </span>
                                            <field name="aliasValue" class="oe-read-only d-inline" readonly="1" widget="email" attrs="{'invisible':  [['aliasName', '=', false]]}" />
                                            <span class="oe-edit-only">
                                                <field name="aliasName" class="oe-inline"/>@<field name="aliasDomain" class="oe-inline" readonly="1"/>
                                            </span>
                                    </div>
                                    <!-- the alias contact must appear when the user start typing and it must disappear
                                        when the string is deleted. -->
                                    <field name="aliasContact" class="oe-inline" string="Accept Emails From"
                                           attrs="{'invisible': ['|', ['aliasName', '=', ''], ['aliasName', '=', false]]}"/>
                                </group>
                                <group name="extraSettings">
                                </group>
                            </group>
                            <div class="row mt16 o-settings-container">
                                <div id="ratingSettings" class="col-lg-6 o-setting-box" groups="project.groupProjectRating">
                                    <div class="o-setting-left-pane">
                                        <field name="ratingActive"/>
                                    </div>
                                    <div class="o-setting-right-pane">
                                        <label for="ratingActive" />
                                        <div class="text-muted">
                                            Get customer feedback
                                        </div>
                                        <div class="mt16" attrs="{'invisible':[['ratingActive','==',false]]}">
                                            <field name="ratingStatus" widget="radio" />
                                            <div  attrs="{'required': [['ratingStatus','=','periodic']], 'invisible': [['ratingStatus','!=','periodic']]}">
                                                <label for="ratingStatusPeriod"/>
                                                <field name="ratingStatusPeriod"/>
                                            </div>
                                            <div class="content-group">
                                                    <div class="mt8">
                                                        <button name="%(project.openTaskTypeFormDomain)d" context="{'projectId':id}" icon="fa-arrow-right" type="action" string="Set a Rating Email Template on Stages" class="btn-link"/>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 o-setting-box"  id="subtaskSettings" groups="project.groupSubtaskProject">
                                    <div class="o-setting-left-pane">
                                        <field name="allowSubtasks" />
                                    </div>
                                    <div class="o-setting-right-pane">
                                        <label for="allowSubtasks" />
                                        <div class="text-muted">
                                            Split your tasks to organize your work into sub-milestones
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 o-setting-box"  id="recurringTasksSetting" groups="project.groupProjectRecurringTasks">
                                    <div class="o-setting-left-pane">
                                        <field name="allowRecurringTasks" />
                                    </div>
                                    <div class="o-setting-right-pane">
                                        <label for="allowRecurringTasks" />
                                        <div class="text-muted">
                                            Auto-generate tasks for regular activities
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 o-setting-box" id="taskDependenciesSetting" groups="project.groupProjectTaskDependencies">
                                    <div class="o-setting-left-pane">
                                        <field name="allowTaskDependencies"/>
                                    </div>
                                    <div class="o-setting-right-pane">
                                        <label for="allowTaskDependencies"/>
                                        <div class="text-muted">
                                            Determine the order in which to perform tasks
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe-chatter">
                    <field name="messageFollowerIds" options="{'postRefresh':true}" help="Follow this project to automatically track the events associated to tasks and issues of this project." groups="base.groupUser"/>
                    <field name="activityIds"/>
                    <field name="messageIds"/>
                </div>
                </form>
            </field>
        </record>

        <record id="viewProjectProjectFilter" model="ir.ui.view">
            <field name="label">project.project.select</field>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <search string="Search Project">
                    <field name="label" string="Project"/>
                    <field name="userId" string="Project Manager"/>
                    <field name="partnerId" string="Customer" filterDomain="[['partnerId', 'childOf', self]]"/>
                    <field name="analyticAccountId"/>
                    <field name="stageId" groups="project.groupProjectStages"/>
                    <field name="tagIds"/>
                    <filter string="My Favorites" name="myProjects" domain="[['favoriteUserIds', 'in', uid]]"/>
                    <separator/>
                    <filter string="Followed" name="followedByMe" domain="[['messageIsFollower', '=', true]]"/>
                    <filter string="My Projects" name="ownProjects" domain="[['userId', '=', uid]]"/>
                    <separator/>
                    <filter string="Open" name="open" domain="[['stageId.fold', '=', false]]" groups="project.groupProjectStages"/>
                    <separator/>
                    <filter string="Archived" name="inactive" domain="[['active', '=', false]]"/>
                    <separator/>
                    <filter invisible="1" string="Late Activities" name="activitiesOverdue"
                        domain="[['myActivityDateDeadline', '&lt;', contextToday().toFormat('yyyy-MM-dd')]]"
                        help="Show all records which has next action date is before today"/>
                    <filter invisible="1" string="Today Activities" name="activitiesToday"
                        domain="[['myActivityDateDeadline', '=', contextToday().toFormat('yyyy-MM-dd')]]"/>
                    <filter invisible="1" string="Future Activities" name="activitiesUpcomingAll"
                        domain="[['myActivityDateDeadline', '&gt;', contextToday().toFormat('yyyy-MM-dd')]]"/>
                    <group expand="0" string="Group By">
                        <filter string="Project Manager" name="Manager" context="{'groupby': 'userId'}"/>
                        <filter string="Customer" name="Partner" context="{'groupby': 'partnerId'}"/>
                        <filter string="Status" name="status" context="{'groupby': 'lastUpdateStatus'}"/>
                        <filter string="Stage" name="groupbyStage" context="{'groupby': 'stageId'}" groups="project.groupProjectStages"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="viewProject" model="ir.ui.view">
            <field name="label">project.project.tree</field>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <tree decoration-muted="active == false" string="Projects" delete="0" multiEdit="1" sample="1">
                    <field name="sequence" optional="show" widget="handle"/>
                    <field name="messageNeedaction" invisible="1"/>
                    <field name="active" invisible="1"/>
                    <field name="label" string="Name" class="font-weight-bold"/>
                    <field name="partnerId" optional="show" string="Customer"/>
                    <field name="privacyVisibility" optional="hide"/>
                    <field name="companyId" optional="show"  groups="base.groupMultiCompany" options="{'noCreate': true, 'noCreateEdit': true}"/>
                    <field name="analyticAccountId" optional="hide" groups="analytic.groupAnalyticAccounting"/>
                    <field name="dateStart" string="Start Date" widget="daterange" options="{'relatedEndDate': 'date'}"/>
                    <field name="date" string="End Date" widget="daterange" options="{'relatedStartDate': 'dateStart'}"/>
                    <field name="userId" optional="show" string="Project Manager" widget="many2oneAvatarUser" options="{'noOpen':true, 'noCreate': true, 'noCreateEdit': true}"/>
                    <field name="lastUpdateColor" invisible="1"/>
                    <field name="tagIds" widget="many2manyTags" options="{'colorField': 'color'}" optional="hide"/>
                    <field name="lastUpdateStatus" string="Status" optional="show" widget="statusWithColor" options="{'colorField': 'lastUpdateColor'}"/>
                    <field name="stageId" options="{'noOpen': true}" optional="show"/>
                </tree>
            </field>
        </record>

        <record id="projectViewKanban" model="ir.ui.view">
            <field name="label">project.project.kanban</field>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <kanban class="o-kanban-mobile">
                    <field name="userId" string="Project Manager"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe-kanban-content oe-kanban-global-click o-kanban-get-form">
                                <div class="row">
                                    <div class="col-12">
                                        <strong><field name="label" string="Project Name"/></strong>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-8">
                                        <field name="partnerId" string="Contact"/>
                                    </div>
                                    <div class="col-4">
                                        <div class="oe-kanban-bottom-right float-right">
                                            <field name="userId" widget="many2oneAvatarUser"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="projectProjectViewFormSimplified" model="ir.ui.view">
            <field name="label">project.project.view.form.simplified</field>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <form string="Project">
                    <group>
                        <field name="label" class="o-project-name oe-inline"
                            string="Project Name" placeholder="e.g. Office Party"/>
                        <field name="userId" invisible="1"/>
                    </group>
                    <div name="aliasDef" colspan="2" attrs="{'invisible': [['aliasDomain', '=', false]]}">
                        <label for="aliasName" class="oe-inline" string="Create tasks by sending an email to"/>
                        <field name="aliasEnabled" invisible="1"/>
                        <span>
                            <field name="aliasName" class="oe-inline" placeholder="e.g. office-party"/>@<field name="aliasDomain" class="oe-inline" readonly="1" />
                        </span>
                    </div>
                </form>
            </field>
        </record>

        <record id="projectProjectViewFormSimplifiedFooter" model="ir.ui.view">
            <field name="label">project.project.view.form.simplified</field>
            <field name="model">project.project</field>
            <field name="inheritId" ref="project.projectProjectViewFormSimplified"/>
            <field name="mode">primary</field>
            <field name="arch" type="xml">
                <xpath expr="//group" position="after">
                    <footer>
                        <button string="Create" name="actionViewTasks" type="object" class="btn-primary o-open-tasks" data-hotkey="q"/>
                        <button string="Discard" class="btn-secondary" special="cancel" data-hotkey="z"/>
                    </footer>
                </xpath>
            </field>
        </record>

        <record id="openCreateProject" model="ir.actions.actwindow">
            <field name="label">Create a Project</field>
            <field name="resModel">project.project</field>
            <field name="viewMode">form</field>
            <field name="viewId" ref="projectProjectViewFormSimplifiedFooter"/>
            <field name="target">new</field>
            <field name="context">{"default_allowBillable": 1}</field>
        </record>

        <record model="ir.ui.view" id="viewProjectKanban">
            <field name="label">project.project.kanban</field>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <kanban class="oe-background-grey o-kanban-dashboard o-project-kanban o-emphasize-colors" onCreate="project.openCreateProject" jsClass="projectProjectKanban" sample="1">
                    <field name="label"/>
                    <field name="partnerId"/>
                    <field name="commercialPartnerId"/>
                    <field name="color"/>
                    <field name="taskCount"/>
                    <field name="labelTasks"/>
                    <field name="aliasId"/>
                    <field name="aliasName"/>
                    <field name="aliasDomain"/>
                    <field name="isFavorite"/>
                    <field name="ratingPercentageSatisfaction"/>
                    <field name="ratingStatus"/>
                    <field name="ratingActive" />
                    <field name="analyticAccountId"/>
                    <field name="date"/>
                    <field name="docCount"/>
                    <field name="privacyVisibility"/>
                    <field name="lastUpdateColor"/>
                    <field name="lastUpdateStatus"/>
                    <field name="tagIds"/>
                    <progressbar field="lastUpdateStatus" colors='{"onTrack": "success", "atRisk": "warning", "offTrack": "danger", "onHold": "info"}'/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="#{kanbanColor(record.color.rawValue)} oe-kanban-global-click o-has-icon oe-kanban-content oe-kanban-card">
                                <div class="o-project-kanban-main ">
                                    <div class="o-kanban-card-content mw-100">
                                        <div class="o-kanban-primary-left">
                                            <div class="o-primary">
                                                <span class="o-text-overflow"><t t-esc="record.label.value"/></span>
                                                <span class="o-text-overflow text-muted" t-if="record.partnerId.value">
                                                    <span class="fa fa-user mr-2" aria-label="Partner" title="Partner"></span><t t-esc="record.partnerId.value"/>
                                                </span>
                                                <div t-if="record.date.rawValue || record.dateStart.rawValue" class="text-muted o-row">
                                                    <span class="fa fa-clock-o mr-2" title="Dates"></span><field name="dateStart"/>
                                                    <i t-if="record.date.rawValue &amp;&amp; record.dateStart.rawValue" class="fa fa-long-arrow-right mx-2 oe-read-only" aria-label="Arrow icon" title="Arrow"/>
                                                    <field name="date"/>
                                                </div>
                                                <div t-if="record.aliasName.value and record.aliasDomain.value" class="text-muted">
                                                    <span class="fa fa-envelope-o mr-2" aria-label="Domain Alias" title="Domain Alias"></span><t t-esc="record.aliasId.value"/>
                                                </div>
                                                <div t-if="record.ratingActive.rawValue" class="text-muted" title="Percentage of happy ratings over the past 30 days." groups="project.groupProjectRating">
                                                    <b>
                                                        <t t-if="record.ratingPercentageSatisfaction.value != -1">
                                                            <i class="fa fa-smile-o" role="img" aria-label="Percentage of satisfaction" title="Percentage of satisfaction"/> <t t-esc="record.ratingPercentageSatisfaction.value"/>%
                                                        </t>
                                                    </b>
                                                </div>
                                                <field name="tagIds" widget="many2manyTags" options="{'colorField': 'color'}"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="container o-kanban-card-manage-pane dropdown-menu" role="menu" groups="base.groupUser">
                                        <div class="row">
                                            <div class="col-6 o-kanban-card-manage-section o-kanban-manage-view">
                                                <div role="menuitem" class="o-kanban-card-manage-title">
                                                    <span>View</span>
                                                </div>
                                                <div role="menuitem">
                                                    <a name="actionViewTasks" type="object">Tasks</a>
                                                </div>
                                                <div role="menuitem" t-if="record.docCount.rawValue">
                                                    <a name="attachmentTreeView" type="object">Documents</a>
                                                </div>
                                            </div>
                                            <div class="col-6 o-kanban-card-manage-section o-kanban-manage-reporting" groups="project.groupProjectManager">
                                                <div role="menuitem" class="o-kanban-card-manage-title">
                                                    <span>Reporting</span>
                                                </div>
                                                <div role="menuitem">
                                                    <a name="actionViewTasksAnalysis" type="object">Tasks Analysis</a>
                                                </div>
                                                <div role="menuitem">
                                                    <a name="%(actionProjectTaskBurndownChartReport)d" type="action">Burndown Chart</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="o-kanban-card-manage-settings row" groups="project.groupProjectManager">
                                            <div role="menuitem" aria-haspopup="true" class="col-8">
                                                <ul class="oe-kanban-colorpicker" data-field="color" role="popup"/>
                                            </div>
                                            <div role="menuitem" class="col-4">
                                                <a t-if="record.privacyVisibility.rawValue == 'portal'" class="dropdown-item" role="menuitem" name="%(project.projectShareWizardAction)d" type="action">Share</a>
                                                <!-- [XBO] TODO: remove the name attribute in this a tag in master -->
                                                <a class="dropdown-item" role="menuitem" type="edit" name="actionViewKanbanProject">Edit</a>
                                            </div>
                                        </div>
                                    </div>
                                    <a class="o-kanban-manage-toggle-button o-dropdown-kanban" href="#" groups="base.groupUser">
                                        <i class="fa fa-ellipsis-v" role="img" aria-label="Manage" title="Manage"/>
                                    </a>
                                    <span>
                                       <field name="isFavorite" widget="booleanFavorite" nolabel="1" forceSave="1" />
                                    </span>
                                </div>
                                <div class="o-kanban-record-bottom mt-3">
                                    <div class="oe-kanban-bottom-left">
                                        <div class="o-project-kanban-boxes">
                                            <a class="o-project-kanban-box" name="actionViewTasks" type="object">
                                                <div>
                                                    <span class="o-value"><t t-esc="record.taskCount.value"/></span>
                                                    <span class="o-label"><t t-esc="record.labelTasks.value"/></span>
                                                </div>
                                            </a>
                                        </div>
                                        <field name="activityIds" widget="kanbanActivity"/>
                                    </div>
                                    <div class="oe-kanban-bottom-right">
                                        <span t-att-class="'o-status-bubble mx-0 o-color-bubble-' + record.lastUpdateColor.value" t-att-title="record.lastUpdateStatus.value"></span>
                                        <field name="userId" widget="many2oneAvatarUser" t-if="record.userId.rawValue"/>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Please update both actwindow when modifying one (openViewProjectAll or openViewProjectAllGroupStage) as one or the other is used in the menu menuProjectConfig -->
        <record id="openViewProjectAll" model="ir.actions.actwindow">
            <field name="label">Projects</field>
            <field name="resModel">project.project</field>
            <field name="domain">[]</field>
            <field name="viewMode">kanban,form</field>
            <field name="viewId" ref="viewProjectKanban"/>
            <field name="searchViewId" ref="viewProjectProjectFilter"/>
            <field name="target">main</field>
            <field name="help" type="html">
                <p class="o-view-nocontent-smiling-face">
                    No projects found. Let's create one!
                </p><p>
                    Projects regroup tasks on the same topic, and each has its dashboard.
                </p>
            </field>
        </record>

        <record id="openViewProjectAllGroupStage" model="ir.actions.actwindow">
            <field name="label">Projects</field>
            <field name="resModel">project.project</field>
            <field name="domain">[]</field>
            <field name="viewMode">kanban,form</field>
            <field name="viewId" ref="viewProjectKanban"/>
            <field name="searchViewId" ref="viewProjectProjectFilter"/>
            <field name="target">main</field>
            <field name="context">{'searchDefault_groupbyStage': 1}</field>
            <field name="help" type="html">
                <p class="o-view-nocontent-smiling-face">
                    No projects found. Let's create one!
                </p><p>
                    Projects regroup tasks on the same topic, and each has its dashboard.
                </p>
            </field>
        </record>

        <record id="openViewProjectAllConfig" model="ir.actions.actwindow">
            <field name="label">Projects</field>
            <field name="resModel">project.project</field>
            <field name="domain">[]</field>
            <field name="viewMode">tree,kanban,form</field>
            <field name="viewIds" eval="[[5, 0, 0],
                [0, 0, {'viewMode': 'tree', 'viewId': refId('viewProject')}],
                [0, 0, {'viewMode': 'kanban', 'viewId': refId('viewProjectKanban')}]]"/>
            <field name="searchViewId" ref="viewProjectProjectFilter"/>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o-view-nocontent-smiling-face">
                   No projects found. Let's create one!
                </p><p>
                    Projects regroup tasks on the same topic, and each has its dashboard.
                </p>
            </field>
        </record>

        <!-- Task -->
        <record id="viewTaskForm2" model="ir.ui.view">
            <field name="label">project.task.form</field>
            <field name="model">project.task</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <form string="Task" class="o-form-project-tasks" jsClass="projectForm">
                    <field name="allowSubtasks" invisible="1" />
                    <field name="isClosed" invisible="1" />
                    <field name="allowRecurringTasks" invisible="1" />
                    <field name="repeatShowDow" invisible="1" />
                    <field name="repeatShowDay" invisible="1" />
                    <field name="repeatShowWeek" invisible="1" />
                    <field name="repeatShowMonth" invisible="1" />
                    <field name="recurrenceId" invisible="1" />
                    <field name="allowTaskDependencies" invisible="1" />
                    <header>
                        <button name="actionAssignToMe" string="Assign to Me" type="object" class="oe-highlight"
                            attrs="{'invisible' : &quot;[['userIds', 'in', uid]]&quot;}" data-hotkey="q"/>
                        <field name="stageId" widget="statusbar" options="{'clickable': '1', 'foldField': 'fold'}" attrs="{'invisible': [['projectId', '=', false], ['stageId', '=', false]]}"/>
                    </header>
                    <div class="alert alert-info oe-edit-only mb-0" role="status" attrs="{'invisible': ['|', ['recurringTask', '=', false], ['recurrenceId', '=', false]]}">
                        <p>Edit recurring task</p>
                        <field name="recurrenceUpdate" widget="radio"/>
                    </div>
                    <sheet string="Task">
                    <div class="oe-button-box" name="buttonBox">
                        <button name="actionOpenParentTask" type="object" class="oe-stat-button" icon="fa-tasks" string="Parent Task" attrs="{'invisible': ['|', ['allowSubtasks', '=', false], ['parentId', '=', false]]}" groups="project.groupSubtaskProject"/>
                        <button name="%(ratingRatingActionTask)d" type="action" attrs="{'invisible': [['ratingCount', '=', 0]]}" class="oe-stat-button" icon="fa-smile-o" groups="project.groupProjectRating">
                            <field name="ratingCount" string="Rating" widget="statinfo"/>
                        </button>
                        <button name="actionRecurringTasks" type="object" attrs="{'invisible': [['recurrenceId', '=', false]]}" class="oe-stat-button" icon="fa-repeat" groups="project.groupProjectRecurringTasks">
                            <div class="o-field-widget o-stat-info">
                                <span class="o-stat-value">
                                    <field name="recurringCount" widget="statinfo" nolabel="1" />
                                    Tasks
                                </span>
                                <span class="o-stat-text">in Recurrence</span>
                            </div>
                        </button>
                        <button name="actionDependentTasks" type="object" attrs="{'invisible': [['dependentTasksCount', '=', 0]]}" class="oe-stat-button" icon="fa-tasks" groups="project.groupProjectTaskDependencies">
                            <div class="o-field-widget o-stat-info">
                                <span class="o-stat-text">Blocking</span>
                                <span class="o-stat-value ">
                                    <field name="dependentTasksCount" widget="statinfo" nolabel="1" />
                                    Tasks
                                </span>
                            </div>
                        </button>
                    </div>
                    <widget name="webRibbon" title="Archived" bgcolor="bg-danger" attrs="{'invisible': [['active', '=', true]]}"/>
                    <div class="oe-title pr-0">
                        <h1 class="d-flex flex-row justify-content-between">
                            <field name="priority" widget="priority" class="mr-3"/>
                            <field name="label" class="o-task-name text-truncate" placeholder="Task Title..." defaultFocus="1" />
                            <field name="kanbanState" widget="stateSelection" class="ml-auto"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <label for="projectId" attrs="{'invisible': [['parentId', '!=', false]]}" class="oe-read-only"/>
                            <div colspan="1" class="oe-read-only">
                                <i class="o-project-task-project-field text-danger" attrs="{'invisible': [['projectId', '!=', false]]}">Private</i>
                                <field name="projectId" attrs="{'invisible': ['|', ['parentId', '!=', false], ['projectId', '=', false]]}" nolabel="1"/>
                            </div>
                            <field name="projectId" attrs="{'invisible': [['parentId', '!=', false]]}" domain="[['active', '=', true], ['companyId', '=', companyId]]"
                                placeholder="Private" class="o-project-task-project-field oe-edit-only"/>
                            <field name="displayProjectId" string="Project" attrs="{'invisible': [['parentId', '=', false]]}" domain="[['active', '=', true], ['companyId', '=', companyId]]"/>
                            <field name="userIds"
                                class="o-task-user-field"
                                options="{'noOpen': true}"
                                widget="many2manyAvatarUser"
                                domain="[['share', '=', false], ['active', '=', true]]"/>
                            <field name="parentId"
                                attrs="{'invisible' : [['allowSubtasks', '=', false]]}"
                                groups="base.groupNoOne"
                            />
                        </group>
                        <group>
                            <field name="active" invisible="1"/>
                            <field name="partnerId" widget="resPartnerMany2one" class="o-task-customer-field"/>
                            <field name="partnerPhone" widget="phone" attrs="{'invisible': true}"/>
                            <field name="dateDeadline" attrs="{'invisible': [['isClosed', '=', true]]}"/>
                            <field name="tagIds" widget="many2manyTags" options="{'colorField': 'color', 'noCreateEdit': true}"/>
                            <field name="recurringTask" attrs="{'invisible': ['|', ['allowRecurringTasks', '=', false], ['active', '=', false]]}"/>
                            <field name="legendBlocked" invisible="1"/>
                            <field name="legendNormal" invisible="1"/>
                            <field name="legendDone" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="descriptionPage" string="Description">
                            <field name="description" type="html" options="{'collaborative': true}"/>
                        </page>
                        <page name="subTasksPage" string="Sub-tasks" attrs="{'invisible': [['allowSubtasks', '=', false]]}">
                            <field name="childIds" context="{'default_projectId': !parentId || !displayProjectId ? projectId : displayProjectId, 'default_userIds': userIds, 'default_parentId': id, 'default_partnerId': partnerId}">
                                <tree editable="bottom">
                                    <field name="projectId" invisible="1"/>
                                    <field name="isClosed" invisible="1"/>
                                    <field name="sequence" widget="handle"/>
                                    <field name="label"/>
                                    <field name="displayProjectId" string="Project" optional="hide"/>
                                    <field name="partnerId" optional="hide"/>
                                    <field name="userIds" widget="many2manyAvatarUser" optional="show" domain="[['share', '=', false], ['active', '=', true]]"/>
                                    <field name="companyId" groups="base.groupMultiCompany" optional="hide"/>
                                    <field name="activityIds" widget="listActivity" optional="hide"/>
                                    <field name="dateDeadline" attrs="{'invisible': [['isClosed', '=', true]]}" optional="show"/>
                                    <field name="tagIds" widget="many2manyTags" options="{'colorField': 'color'}" optional="hide"/>
                                    <field name="kanbanState" widget="stateSelection" optional="hide"/>
                                    <field name="stageId" optional="show" context="{'default_projectId': projectId}"/>
                                    <button name="actionOpenTask" type="object" title="View Task" string="View Task" class="btn btn-link pull-right"/>
                                </tree>
                            </field>
                        </page>
                        <page name="taskDependencies" string="Blocked By" attrs="{'invisible': [['allowTaskDependencies', '=', false]]}" groups="project.groupProjectTaskDependencies">
                            <field name="dependOnIds" nolabel="1">
                                <tree editable="bottom">
                                    <field name="isClosed" invisible="1" />
                                    <field name="label" />
                                    <field name="projectId" optional="hide" />
                                    <field name="userIds" widget="many2manyAvatarUser" optional="show" domain="[['share', '=', false], ['active', '=', true]]"/>
                                    <field name="companyId" optional="hide" groups="base.groupMultiCompany" />
                                    <field name="activityIds" widget="listActivity" optional="hide"/>
                                    <field name="dateDeadline" attrs="{'invisible': [['isClosed', '=', true]]}" optional="show" />
                                    <field name="tagIds" widget="many2manyTags" options="{'colorField': 'color'}" optional="hide"/>
                                    <field name="kanbanState" widget="stateSelection" optional="hide" />
                                    <field name="stageId" optional="show" />
                                    <button class="oe-link float-right" string="View Task" name="actionOpenTask" type="object"/>
                                </tree>
                            </field>
                        </page>
                        <page name="recurrence" string="Recurrence" attrs="{'invisible': [['recurringTask', '=', false]]}">
                            <group>
                                <group>
                                    <label for="repeatInterval" />
                                    <div class="o-col">
                                        <div class="o-row">
                                            <field name="repeatInterval" attrs="{'required': [['recurringTask', '=', true]]}" />
                                            <field name="repeatUnit" attrs="{'required': [['recurringTask', '=', true]]}" />
                                        </div>
                                        <widget name="weekDays" attrs="{'invisible': [['repeatShowDow', '=', false]]}"/>
                                    </div>

                                    <label for="repeatOnMonth" string="Repeat On" attrs="{'invisible': [['repeatUnit', 'not in', ['month', 'year']]]}" />
                                    <div class="o-row">
                                        <field name="repeatOnMonth" attrs="{'invisible': [['repeatUnit', '!=', 'month']], 'required': [['repeatUnit', '=', 'month']]}" />
                                        <field name="repeatOnYear" attrs="{'invisible': [['repeatUnit', '!=', 'year']], 'required': [['repeatUnit', '=', 'year']]}" />

                                        <field name="repeatDay" attrs="{'invisible': [['repeatShowDay', '=', false]], 'required': [['repeatShowDay', '=', true]]}" />
                                        <field name="repeatWeek" attrs="{'invisible': [['repeatShowWeek', '=', false]], 'required': [['repeatShowWeek', '=', true]]}" />
                                        <field name="repeatWeekday" attrs="{'invisible': [['repeatShowWeek', '=', false]], 'required': [['repeatShowWeek', '=', true]]}" />
                                        <span attrs="{'invisible': ['|', ['repeatShowWeek', '=', false], ['repeatShowMonth', '=', false]]}">of</span>
                                        <field name="repeatMonth" attrs="{'invisible': [['repeatShowMonth', '=', false]], 'required': [['repeatShowMonth', '=', true]]}" />
                                    </div>
                                    <!-- Those fields are added to trigger the compute method for the recurrence feature. -->
                                    <field name="mon" invisible="1"/>
                                    <field name="tue" invisible="1"/>
                                    <field name="wed" invisible="1"/>
                                    <field name="thu" invisible="1"/>
                                    <field name="fri" invisible="1"/>
                                    <field name="sat" invisible="1"/>
                                    <field name="sun" invisible="1"/>

                                    <label for="repeatType" />
                                    <div class="o-row">
                                        <field name="repeatType" attrs="{'required': [['recurringTask', '=', true]]}" />
                                        <field name="repeatUntil" attrs="{'invisible': [['repeatType', '!=', 'until']], 'required': [['repeatType', '=', 'until']]}" />
                                        <field name="repeatNumber" attrs="{'invisible': [['repeatType', '!=', 'after']], 'required': [['repeatType', '=', 'after']]}" />
                                    </div>
                                </group>
                            </group>
                            <group attrs="{'invisible': ['|', ['recurringTask', '=', false], ['recurrenceMessage', '=', false]]}">
                                <div class="alert alert-success o-form-project-recurrence-message" role="status">
                                    <field name="recurrenceMessage" widget="html" class="mb-0" />
                                </div>
                            </group>
                        </page>
                        <page name="extraInfo" string="Extra Info" groups="base.groupNoOne">
                            <group>
                                <group>
                                    <field name="analyticAccountId" groups="analytic.groupAnalyticAccounting" context="{'default_partnerId': partnerId}"/>
                                    <field name="analyticTagIds" groups="analytic.groupAnalyticTags" widget="many2manyTags"/>
                                    <field name="sequence" groups="base.groupNoOne"/>
                                    <field name="emailFrom" invisible="1"/>
                                    <field name="emailCc" groups="base.groupNoOne"/>
                                    <field name="companyId" groups="base.groupMultiCompany" options="{'noCreate': true}"/>
                                    <field name="displayedImageId" groups="base.groupNoOne" options="{'noCreate': true}"/>
                                </group>
                                <group>
                                    <field name="dateAssign" groups="base.groupNoOne"/>
                                    <field name="dateLastStageUpdate" groups="base.groupNoOne"/>
                                </group>
                                <group string="Working Time to Assign" attrs="{'invisible': [['workingHoursOpen', '=', 0.0]]}">
                                    <field name="workingHoursOpen" string="Hours"/>
                                    <field name="workingDaysOpen" string="Days"/>
                                </group>
                                <group string="Working Time to Close" attrs="{'invisible': [['workingHoursClose', '=', 0.0]]}">
                                    <field name="workingHoursClose" string="Hours"/>
                                    <field name="workingDaysClose" string="Days"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                    </sheet>
                    <div class="oe-chatter">
                        <field name="messageFollowerIds" options="{'postRefresh':true}" groups="base.groupUser"/>
                        <field name="activityIds"/>
                        <field name="messageIds"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="portalShareAction" model="ir.actions.actwindow">
            <field name="label">Share</field>
            <field name="resModel">portal.share</field>
            <field name="viewMode">form</field>
            <field name="target">new</field>
            <field name="bindingModelId" ref="model_projectTask"/>
            <field name="bindingViewTypes">form</field>
        </record>

        <record id="unlinkProjectAction" model="ir.actions.server">
            <field name="label">Delete</field>
            <field name="modelId" ref="project.model_projectProject"/>
            <field name="bindingModelId" ref="project.model_projectProject"/>
            <field name="bindingViewTypes">form,list</field>
            <field name="state">code</field>
            <field name="code">action = records.actionUnlink()</field>
        </record>

        <record id="quickCreateTaskForm" model="ir.ui.view">
            <field name="label">project.task.form.quickCreate</field>
            <field name="model">project.task</field>
            <field name="priority">1000</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <field name="label" string = "Task Title" placeholder="e.g. New Design"/>
                        <field name="userIds" options="{'noOpen': true, 'noCreate': true}" domain="[['share', '=', false], ['active', '=', true]]"
                            widget="many2manyAvatarUser"/>
                        <field name="companyId" invisible="1"/>
                        <field name="parentId" invisible="1" groups="base.groupNoOne"/>
                        <field name="description" invisible="1"/>
                    </group>
                </form>
            </field>
        </record>

        <!-- Project Task Kanban View -->
        <record model="ir.ui.view" id="viewTaskKanban">
            <field name="label">project.task.kanban</field>
            <field name="model">project.task</field>
            <field name="arch" type="xml">
                <kanban defaultGroupby="stageId" class="o-kanban-small-column o-kanban-project-tasks" onCreate="quickCreate"
                    quickCreateView="project.quickCreateTaskForm" examples="project" jsClass="projectTaskKanban" sample="1">
                    <field name="color"/>
                    <field name="priority"/>
                    <field name="stageId" options='{"groupby_tooltip": {"description": "Description"}}'/>
                    <field name="userIds"/>
                    <field name="partnerId"/>
                    <field name="sequence"/>
                    <field name="isClosed"/>
                    <field name="partnerIsCompany"/>
                    <field name="displayedImageId"/>
                    <field name="active"/>
                    <field name="legendBlocked"/>
                    <field name="legendNormal"/>
                    <field name="legendDone"/>
                    <field name="activityIds"/>
                    <field name="activityState"/>
                    <field name="ratingLastValue"/>
                    <field name="ratingIds"/>
                    <field name="allowSubtasks"/>
                    <field name="childText"/>
                    <field name="isPrivate"/>
                    <progressbar field="kanbanState" colors='{"done": "success", "blocked": "danger", "normal": "muted"}'/>
                    <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="{{!selectionMode ? 'oe-kanban-color-' + kanbanGetcolor(record.color.rawValue) : ''}} oe-kanban-card oe-kanban-global-click">
                            <div class="oe-kanban-content">
                                <div class="o-kanban-record-top">
                                    <div class="o-kanban-record-headings">
                                        <strong class="o-kanban-record-title">
                                            <s t-if="!record.active.rawValue"><field name="label" widget="nameWithSubtaskCount"/></s>
                                            <t t-else=""><field name="label" widget="nameWithSubtaskCount"/></t>
                                        </strong>
                                        <t t-if="!record.isPrivate.rawValue">
                                            <span invisible="(context['default_projectId'] ?? false)"><br/><field name="projectId" required="1"/></span>
                                        </t>
                                        <t t-else="">
                                            <br/>
                                            <span class="fa fa-lock text-muted"/><span class="text-muted"> Private</span>
                                        </t>
                                        <br />
                                        <t t-if="record.partnerId.value">
                                            <span t-if="!record.partnerIsCompany.rawValue">
                                                <field name="commercialPartnerId"/>
                                            </span>
                                            <span t-else="">
                                                <field name="partnerId"/>
                                            </span>
                                        </t>
                                        <t t-else="record.emailFrom.rawValue"><span><field name="emailFrom"/></span></t>
                                    </div>
                                    <div class="o-dropdown-kanban dropdown" t-if="!selectionMode" groups="base.groupUser">
                                        <a role="button" class="dropdown-toggle o-no-caret btn" data-toggle="dropdown" data-display="static" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                                            <span class="fa fa-ellipsis-v"/>
                                        </a>
                                        <div class="dropdown-menu" role="menu">
                                            <a t-if="widget.editable" role="menuitem" type="setCover" class="dropdown-item" data-field="displayedImageId">Set Cover Image</a>
                                            <a name="%(portal.portalShareAction)d" role="menuitem" type="action" class="dropdown-item">Share</a>
                                            <a t-if="widget.editable" role="menuitem" type="edit" class="dropdown-item">Edit</a>
                                            <div role="separator" class="dropdown-divider"></div>
                                            <ul class="oe-kanban-colorpicker" data-field="color"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="o-kanban-record-body">
                                    <field name="tagIds" widget="many2manyTags" options="{'colorField': 'color'}"/>
                                    <div t-if="record.dateDeadline.rawValue" name="dateDeadline" attrs="{'invisible': [['isClosed', '=', true]]}">
                                        <field name="dateDeadline" widget="remainingDays"/>
                                    </div>
                                    <div t-if="record.displayedImageId.value">
                                        <field name="displayedImageId" widget="attachmentImage"/>
                                    </div>
                                </div>
                                <div class="o-kanban-record-bottom" t-if="!selectionMode">
                                    <div class="oe-kanban-bottom-left">
                                        <field name="priority" widget="priority"/>
                                        <field name="activityIds" widget="kanbanActivity"/>
                                        <b t-if="record.ratingIds.rawValue.length">
                                            <span style="font-weight:bold;" class="fa fa-fw mt4 fa-smile-o text-success" t-if="record.ratingLastValue.value == 5" title="Latest Rating: Satisfied" role="img" aria-label="Happy face"/>
                                            <span style="font-weight:bold;" class="fa fa-fw mt4 fa-meh-o text-warning" t-if="record.ratingLastValue.value == 3" title="Latest Rating: Okay" role="img" aria-label="Neutral face"/>
                                            <span style="font-weight:bold;" class="fa fa-fw mt4 fa-frown-o text-danger" t-if="record.ratingLastValue.value == 1" title="Latest Rating: Dissatisfied" role="img" aria-label="Sad face"/>
                                        </b>
                                    </div>
                                    <div class="oe-kanban-bottom-right" t-if="!selectionMode">
                                        <field name="kanbanState" widget="stateSelection" groups="base.groupUser" invisible="(context['fsmMode'] ?? false)"/>
                                        <t t-if="record.userIds.rawValue"><field name="userIds" widget="many2manyAvatarUser"/></t>
                                    </div>
                                </div>
                            </div>
                            <div class="oe-clear"></div>
                        </div>
                    </t>
                    </templates>
                </kanban>
            </field>
         </record>

        <record id="viewTaskTree2" model="ir.ui.view">
            <field name="label">project.task.tree</field>
            <field name="model">project.task</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <tree string="Tasks" multiEdit="1" sample="1" jsClass="projectList">
                    <field name="messageNeedaction" invisible="1" readonly="1"/>
                    <field name="isClosed" invisible="1" />
                    <field name="allowSubtasks" invisible="1" />
                    <field name="sequence" invisible="1" readonly="1"/>
                    <field name="priority" widget="priority" optional="show" nolabel="1"/>
                    <field name="label" widget="nameWithSubtaskCount"/>
                    <field name="childText" invisible="1"/>
                    <field name="projectId" optional="show" readonly="1"/>
                    <field name="partnerId" optional="hide"/>
                    <field name="parentId" optional="hide" attrs="{'invisible': [['allowSubtasks', '=', false]]}" groups="base.groupNoOne"/>
                    <field name="userIds" optional="show" widget="many2manyAvatarUser" domain="[['share', '=', false], ['active', '=', true]]"/>
                    <field name="companyId" groups="base.groupMultiCompany" optional="show"/>
                    <field name="activityIds" widget="listActivity" optional="show"/>
                    <field name="dateDeadline" optional="hide" widget="remainingDays" attrs="{'invisible': [['isClosed', '=', true]]}"/>
                    <field name="tagIds" widget="many2manyTags" options="{'colorField': 'color'}" optional="show"/>
                    <field name="kanbanState" widget="selection" optional="hide" />
                    <field name="stageId" invisible="context['setVisible'] ?? false" optional="show" readonly="!context['default_projectId']"/>
                    <field name="recurrenceId" invisible="1" />
                </tree>
            </field>
        </record>

        <record id="projectTaskViewTreeActivity" model="ir.ui.view">
            <field name="label">project.task.tree.activity</field>
            <field name="model">project.task</field>
            <field name="arch" type="xml">
                <tree string="Next Activities" decoration-danger="!isClosed &amp;&amp; activityDateDeadline &lt; currentDate" defaultOrder="activityDateDeadline" multiEdit="1">
                    <field name="isClosed"/>
                    <field name="label"/>
                    <field name="projectId"/>
                    <field name="activityDateDeadline"/>
                    <field name="activityTypeId"/>
                    <field name="activitySummary"/>
                    <field name="stageId"/>
                </tree>
            </field>
        </record>

        <record id="viewTaskCalendar" model="ir.ui.view">
            <field name="label">project.task.calendar</field>
            <field name="model">project.task</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar dateStart="dateDeadline" string="Tasks" mode="month" color="userIds" eventLimit="5"
                          hideTime="true" jsClass="projectCalendar" eventOpenPopup="true" quickAdd="false">
                    <field name="projectId" filters="1"/>
                    <field name="userIds" widget="many2manyAvatarUser"/>
                    <field name="partnerId" attrs="{'invisible': [['partnerId', '=', false]]}"/>
                    <field name="priority" widget="priority"/>
                    <field name="dateDeadline"/>
                    <field name="tagIds" widget="many2manyTags" attrs="{'invisible': [['tagIds', '=', []]]}"/>
                    <field name="stageId"/>
                    <field name="kanbanState"/>
                </calendar>
            </field>
        </record>

        <record id="viewProjectTaskPivot" model="ir.ui.view">
            <field name="label">project.task.pivot</field>
            <field name="model">project.task</field>
            <field name="arch" type="xml">
                <pivot string="Tasks" sample="1" jsClass="projectPivot">
                    <field name="projectId" type="row"/>
                    <field name="stageId" type="col"/>
                    <field name="color" invisible="1"/>
                    <field name="ratingLastValue" type="measure" string="Rating (/5)"/>
                    <field name="sequence" invisible="1"/>
                    <field name="plannedHours" widget="floatTime"/>
                    <field name="workingHoursClose" widget="floatTime"/>
                    <field name="workingHoursOpen" widget="floatTime"/>
                </pivot>
            </field>
        </record>

        <record id="viewProjectTaskGraph" model="ir.ui.view">
            <field name="label">project.task.graph</field>
            <field name="model">project.task</field>
            <field name="arch" type="xml">
                <graph string="Tasks" sample="1" jsClass="projectGraph">
                    <field name="projectId"/>
                    <field name="stageId"/>
                    <field name="color" invisible="1"/>
                    <field name="sequence" invisible="1"/>
                    <field name="ratingLastValue" type="measure" string="Rating (/5)"/>
                </graph>
            </field>
        </record>

        <record id="projectTaskViewActivity" model="ir.ui.view">
            <field name="label">project.task.activity</field>
            <field name="model">project.task</field>
            <field name="arch" type="xml">
                <activity string="Project Tasks" jsClass="projectActivity">
                    <field name="userIds"/>
                    <templates>
                        <div class="justify-content-between" t-name="activity-box">
                            <field name="userIds" widget="many2manyAvatarUser"/>
                            <div class="text-right">
                                <span t-att-title="record.label.value">
                                    <field name="label" display="full"/>
                                </span>
                                <span t-att-title="record.projectId.value">
                                    <field name="projectId" muted="1" display="full" invisible="context['default_projectId'] ?? false"/>
                                </span>
                            </div>
                        </div>
                    </templates>
                </activity>
            </field>
        </record>

        <record id="actionViewTask" model="ir.actions.actwindow">
            <field name="label">Tasks</field>
            <field name="resModel">project.task</field>
            <field name="viewMode">kanban,tree,form,calendar,pivot,graph,activity</field>
            <field name="context">{'searchDefault_myTasks': 1}</field>
            <field name="domain">[['displayProjectId', '!=', false]]</field>
            <field name="searchViewId" ref="viewTaskSearchForm"/>
            <field name="help" type="html">
                <p class="o-view-nocontent-smiling-face">
                    No tasks found. Let's create one!
                </p><p>
                    To get things done, use activities and status on tasks.<br/>
                    Chat in real-time or by email to collaborate efficiently.
                </p>
            </field>
        </record>

        <record id="actionViewAllTask" model="ir.actions.actwindow">
            <field name="label">My Tasks</field>
            <field name="resModel">project.task</field>
            <field name="viewMode">kanban,tree,form,calendar,pivot,graph,activity</field>
            <field name="context">{'searchDefault_myTasks': 1, 'searchDefault_personalStage': 1, 'allTask': 0}</field>
            <field name="searchViewId" ref="viewTaskSearchFormExtended"/>
            <field name="help" type="html">
                <p class="o-view-nocontent-smiling-face">
                    No tasks found. Let's create one!
                </p><p>
                     To get things done, use activities and status on tasks.<br/>
                    Chat in real-time or by email to collaborate efficiently.
                </p>
            </field>
        </record>

        <record id="openViewTaskListKanban" model="ir.actions.actwindow.view">
            <field name="sequence" eval="0"/>
            <field name="viewMode">kanban</field>
            <field name="actwindowId" ref="actionViewTask"/>
        </record>
        <record id="openViewTaskListTree" model="ir.actions.actwindow.view">
            <field name="sequence" eval="1"/>
            <field name="viewMode">tree</field>
            <field name="actwindowId" ref="actionViewTask"/>
        </record>

        <menuitem name="My Tasks" id="menuProjectManagement" parent="menuMainPm"
            action="actionViewAllTask" sequence="2" groups="base.groupNoOne,groupProjectUser"/>

        <record id="projectTaskActionFromPartner" model="ir.actions.actwindow">
            <field name="label">Tasks</field>
            <field name="resModel">project.task</field>
            <field name="viewMode">kanban,tree,form</field>
            <field name="searchViewId" ref="viewTaskSearchFormExtended"/>
        </record>

        <record id="actionViewTaskOverpassedDraft" model="ir.actions.actwindow">
            <field name="label">Overpassed Tasks</field>
            <field name="resModel">project.task</field>
            <field name="viewMode">tree,form,calendar,graph,kanban</field>
            <field name="domain">[['isClosed', '=', false], ['dateDeadline','&lt;',toFormat('yyyy-MM-dd')], ['displayProjectId', '!=', false]]</field>
            <field name="filter" eval="true"/>
            <field name="searchViewId" ref="viewTaskSearchFormExtended"/>
        </record>

        <!-- Opening task when double clicking on project -->
        <record id="dblcProj" model="ir.actions.actwindow">
            <field name="resModel">project.task</field>
            <field name="label">Project's tasks</field>
            <field name="viewMode">tree,form,calendar,graph,kanban</field>
            <field name="domain">[['projectId', '=', activeId]]</field>
            <field name="context">{'projectId': activeId}</field>
        </record>

        <!-- Menu item for project -->
        <menuitem id="menuTasksConfig" name="GTD" parent="menuProjectConfig" sequence="2"/>

        <menuitem action="projectProjectStageConfigure" id="menuProjectConfigProjectStage" name="Project Stages" parent="menuProjectConfig" sequence="9" groups="project.groupProjectStages"/>

        <menuitem action="openTaskTypeForm" id="menuProjectConfigProject" name="Task Stages" parent="menuProjectConfig" sequence="10" groups="base.groupNoOne"/>

        <menuitem action="openViewProjectAll" id="menuProjects" name="Projects" parent="menuMainPm" sequence="1"/>
        <menuitem action="openViewProjectAllGroupStage" id="menuProjectsGroupStage" name="Projects" parent="menuMainPm" sequence="1" groups="project.groupProjectStages"/>
        <menuitem action="openViewProjectAllConfig" id="menuProjectsConfig" name="Projects" parent="menuProjectConfig" sequence="5"/>

        <!-- User Form -->
        <record id="actResUsers2ProjectTaskOpened" model="ir.actions.actwindow">
            <field name="label">Assigned Tasks</field>
            <field name="resModel">project.task</field>
            <field name="viewMode">tree,form,calendar,graph</field>
            <field name="context">{'searchDefault_userIds': [activeId], 'default_userIds': [[6, 0, [activeId]]]}</field>
            <field name="domain">[['displayProjectId', '!=', false]]</field>
            <field name="bindingModelId" ref="base.model_resUsers"/>
            <field name="bindingViewTypes">form</field>
        </record>

        <!-- Tags -->
        <record model="ir.ui.view" id="projectTagsSearchView">
            <field name="label">Tags</field>
            <field name="model">project.tags</field>
            <field name="arch" type="xml">
                <search string="Issue Version">
                    <field name="label"/>
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="projectTagsFormView">
            <field name="label">Tags</field>
            <field name="model">project.tags</field>
            <field name="arch" type="xml">
                <form string="Tags">
                    <sheet>
                        <group>
                            <field name="label"/>
                            <field name="color" widget="colorPicker"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="projectTagsTreeView">
            <field name="label">Tags</field>
            <field name="model">project.tags</field>
            <field name="arch" type="xml">
                <tree string="Tags" editable="top" sample="1">
                    <field name="label"/>
                    <field name="color" widget="colorPicker" optional="show"/>
                </tree>
            </field>
        </record>

        <record id="projectTagsAction" model="ir.actions.actwindow">
            <field name="label">Tags</field>
            <field name="resModel">project.tags</field>
            <field name="help" type="html">
              <p class="o-view-nocontent-smiling-face">
                No tags found. Let's create one!
              </p>
              <p>
                  Use tags to categorize your tasks.
              </p>
            </field>
        </record>
        <menuitem action="projectTagsAction" id="menuProjectTagsAct" parent="menuProjectConfig"/>

        <!-- Reporting menus -->
        <menuitem id="menuProjectReport" name="Reporting"
            groups="project.groupProjectManager"
            parent="menuMainPm" sequence="99"/>

        <menuitem id="menuProjectReportTaskAnalysis"
            name="Tasks Analysis"
            action="project.actionProjectTaskUserTree"
            parent="menuProjectReport"
            sequence="10"/>

        <menuitem id="ratingRatingMenuProject"
            action="ratingRatingActionProjectReport"
            parent="menuProjectReport"
            groups="project.groupProjectRating"
            sequence="40"/>

        <record id="projectViewKanbanInheritProject" model="ir.ui.view">
            <field name="label">project.kanban.inherit.project</field>
            <field name="model">project.project</field>
            <field name="inheritId" ref="project.viewProjectKanban"/>
            <field name="priority">200</field>
            <field name="arch" type="xml">
                <xpath expr="/kanban" position="inside">
                    <field name="id"/>
                </xpath>
                <xpath expr="//div[contains(@class, 'o-kanban-manage-view')]" position="inside">
                    <div role="menuitem" groups="project.groupProjectManager">
                        <a name="%(project.projectUpdateAllAction)d" type="action" t-attf-context="{'activeId': #{record.id.rawValue}}">Project Updates</a>
                    </div>
                </xpath>
            </field>
        </record>
</verp>
